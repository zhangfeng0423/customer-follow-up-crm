# æ™ºèƒ½CRMå®¢æˆ·è·Ÿè¿›å·¥å…· - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Docker 20.0+
- Docker Compose 2.0+
- Git

### ä¸€é”®éƒ¨ç½²

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <your-repo-url>
cd customer

# 2. å¤åˆ¶ç¯å¢ƒå˜é‡æ–‡ä»¶å¹¶é…ç½®
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œè®¾ç½®æ‚¨çš„æ•°æ®åº“å¯†ç å’Œå…¶ä»–é…ç½®

# 3. æ„å»ºå¹¶å¯åŠ¨æœåŠ¡
docker-compose up -d

# 4. ç­‰å¾…æœåŠ¡å¯åŠ¨ï¼ˆå¤§çº¦1-2åˆ†é’Ÿï¼‰
docker-compose logs -f crm-app
```

æœåŠ¡å¯åŠ¨åï¼Œè®¿é—® http://localhost:3000 å³å¯ä½¿ç”¨åº”ç”¨ã€‚

## ğŸ“‹ è¯¦ç»†é…ç½®

### 1. ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
# æ•°æ®åº“é…ç½®ï¼ˆå¿…é¡»è®¾ç½®å¼ºå¯†ç ï¼‰
POSTGRES_PASSWORD=your_secure_password_here

# Next.jsé…ç½®
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your_nextauth_secret_here_make_it_long_and_random

# åº”ç”¨é…ç½®
NODE_ENV=production
```

### 2. æ•°æ®åº“é…ç½®

ç³»ç»Ÿä½¿ç”¨ PostgreSQL ä½œä¸ºä¸»æ•°æ®åº“ï¼Œé…ç½®å¦‚ä¸‹ï¼š

- **æ•°æ®åº“å**: `crm_db`
- **ç”¨æˆ·å**: `crm_user`
- **å¯†ç **: ç”±ç¯å¢ƒå˜é‡ `POSTGRES_PASSWORD` è®¾ç½®

### 3. æ–‡ä»¶å­˜å‚¨

ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶å­˜å‚¨åœ¨ `./public/uploads` ç›®å½•ä¸­ï¼Œé€šè¿‡Dockerå·æŒ‚è½½æŒä¹…åŒ–ä¿å­˜ã€‚

## ğŸ³ Docker æœåŠ¡è¯´æ˜

### æœåŠ¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   crm-app       â”‚    â”‚   postgres       â”‚
â”‚   (Next.js)      â”‚    â”‚   (PostgreSQL)    â”‚
â”‚   Port: 3000     â”‚    â”‚   Port: 5432      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœåŠ¡è¯¦æƒ…

1. **crm-app**: ä¸»åº”ç”¨æœåŠ¡
   - åŸºäº Node.js 18 Alpine
   - è¿è¡Œ Next.js åº”ç”¨
   - ç«¯å£: 3000

2. **postgres**: æ•°æ®åº“æœåŠ¡
   - PostgreSQL 15 Alpine
   - æŒä¹…åŒ–æ•°æ®å­˜å‚¨
   - ç«¯å£: 5432

3. **redis**: ç¼“å­˜æœåŠ¡ï¼ˆå¯é€‰ï¼‰
   - Redis 7 Alpine
   - æä¾›åº”ç”¨ç¼“å­˜
   - ç«¯å£: 6379

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker-compose logs -f crm-app

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker-compose logs -f postgres
```

### æ•°æ®åº“ç®¡ç†

```bash
# æ•°æ®åº“è¿ç§»
docker-compose exec crm-app pnpm db:prod:migrate

# æŸ¥çœ‹æ•°æ®åº“
docker-compose exec postgres psql -U crm_user -d crm_db

# å¤‡ä»½æ•°æ®åº“
docker-compose exec postgres pg_dump -U crm_user crm_db > backup.sql

# æ¢å¤æ•°æ®åº“
docker-compose exec -T postgres psql -U crm_user -d crm_db < backup.sql
```

### ç¤ºä¾‹æ•°æ®

é¦–æ¬¡éƒ¨ç½²æ—¶ï¼Œå¯ä»¥è¿è¡Œç¤ºä¾‹æ•°æ®è„šæœ¬ï¼š

```bash
# ç­‰å¾…æ•°æ®åº“å¯åŠ¨å®Œæˆ
docker-compose exec crm-app pnpm db:seed
```

è¿™å°†åˆ›å»ºï¼š
- 1ä¸ªç®¡ç†å‘˜è´¦æˆ·
- 5ä¸ªç¤ºä¾‹å®¢æˆ·
- æ¯ä¸ªå®¢æˆ·3æ¡è·Ÿè¿›è®°å½•
- å¯¹åº”çš„ä¸‹ä¸€æ­¥è®¡åˆ’

## ğŸ”’ å®‰å…¨é…ç½®

### ç”Ÿäº§ç¯å¢ƒå®‰å…¨å»ºè®®

1. **æ›´æ”¹é»˜è®¤å¯†ç **
   - ä¿®æ”¹ `.env` æ–‡ä»¶ä¸­çš„æ•°æ®åº“å¯†ç 
   - ä½¿ç”¨å¼ºå¯†ç ï¼ˆè‡³å°‘16ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦ï¼‰

2. **HTTPSé…ç½®**
   - åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é…ç½®åå‘ä»£ç†ï¼ˆå¦‚Nginxï¼‰
   - å¯ç”¨SSLè¯ä¹¦

3. **ç½‘ç»œå®‰å…¨**
   - é™åˆ¶æ•°æ®åº“ç«¯å£è®¿é—®ï¼ˆä»…å†…éƒ¨ç½‘ç»œï¼‰
   - é…ç½®é˜²ç«å¢™è§„åˆ™

4. **å®šæœŸå¤‡ä»½**
   - è®¾ç½®æ•°æ®åº“å®šæœŸå¤‡ä»½
   - å¤‡ä»½ä¸Šä¼ æ–‡ä»¶ç›®å½•

## ğŸš€ æ‰©å±•éƒ¨ç½²

### é«˜å¯ç”¨éƒ¨ç½²

å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®è€ƒè™‘ï¼š

1. **æ•°æ®åº“é›†ç¾¤**
   - PostgreSQLä¸»ä»å¤åˆ¶
   - è¿æ¥æ± é…ç½®

2. **è´Ÿè½½å‡è¡¡**
   - å¤šä¸ªåº”ç”¨å®ä¾‹
   - åå‘ä»£ç†è´Ÿè½½å‡è¡¡

3. **ç›‘æ§å‘Šè­¦**
   - æœåŠ¡å¥åº·æ£€æŸ¥
   - æ—¥å¿—æ”¶é›†å’Œåˆ†æ

### äº‘å¹³å°éƒ¨ç½²

æœ¬Dockeré…ç½®å…¼å®¹ä»¥ä¸‹äº‘å¹³å°ï¼š

- AWS ECS/EKS
- Azure Container Instances/AKS
- Google Cloud Run/GKE
- é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡ACK

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£å†²çª**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   lsof -i :3000
   lsof -i :5432
   ```

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
   docker-compose exec postgres pg_isready -U crm_user -d crm_db

   # æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
   docker-compose logs postgres
   ```

3. **åº”ç”¨å¯åŠ¨å¤±è´¥**
   ```bash
   # æŸ¥çœ‹åº”ç”¨æ—¥å¿—
   docker-compose logs crm-app

   # é‡å¯æœåŠ¡
   docker-compose restart crm-app
   ```

### é‡ç½®éƒ¨ç½²

å¦‚éœ€å®Œå…¨é‡ç½®éƒ¨ç½²ï¼š

```bash
# åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰æœåŠ¡
docker-compose down -v

# åˆ é™¤æ‰€æœ‰é•œåƒ
docker rmi $(docker images -q crm-app)

# é‡æ–°æ„å»ºå’Œå¯åŠ¨
docker-compose up -d --build
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°éƒ¨ç½²é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼š`docker-compose logs -f`
2. æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š`docker-compose ps`
3. å‚è€ƒæœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†

---

**éƒ¨ç½²æˆåŠŸï¼** ğŸ‰

æ‚¨çš„æ™ºèƒ½CRMå®¢æˆ·è·Ÿè¿›å·¥å…·ç°åœ¨å·²ç»è¿è¡Œåœ¨Docker + PostgreSQLç¯å¢ƒä¸­ã€‚è®¿é—® http://localhost:3000 å¼€å§‹ä½¿ç”¨ï¼